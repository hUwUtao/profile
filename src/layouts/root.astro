---
import { ViewTransitions } from "astro:transitions";

import Favicon from "../components/favicon.astro";
import { getOgImagePath } from "../core/og";
import "../styles/style.sass";

type Props = {
	title?: string;
	meta?: string;
	keyw?: string[];
	ogType?: "website" | "article";
};

export type P = Props;

const { title, meta, keyw, ogType = "website" } = Astro.props;
const site = Astro.site;
const canonicalUrl = new URL(Astro.url.pathname, site || Astro.url).toString();
const seoTitle = title ? `@stdpi - ${title}` : "i am @stdpi";
const seoDescription =
	meta || "random software engineer, or a tech enthusiasts";
const seoImage = site
	? new URL(getOgImagePath(Astro.url.pathname), site).toString()
	: undefined;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <Favicon />
    <!-- <ViewTransitions /> -->
    <link rel="preconnect" href="https://cdn.stdpi.work" />
    <link rel="preconnect" href="https://esm.sh" />
    <link
      rel="stylesheet"
      href="https://cdn.stdpi.work/assets/fonts/departuremono/stylesheet.css"
    />
    <title>{seoTitle}</title>
    <meta name="description" content={seoDescription} />
    <meta name="generator" content={Astro.generator} />
    <link rel="canonical" href={canonicalUrl} />
    <meta
      name="keywords"
      content={["stdpi huwutao dev".split(" "), ...(keyw || [])].join(", ")}
    />
    <meta property="og:title" content={seoTitle} />
    <meta property="og:type" content={ogType} />
    <meta property="og:description" content={seoDescription} />
    <meta property="og:url" content={canonicalUrl} />
    {seoImage && <meta property="og:image" content={seoImage} />}
    {seoImage && <meta property="og:image:alt" content={seoTitle} />}
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={seoTitle} />
    <meta name="twitter:description" content={seoDescription} />
    {seoImage && <meta name="twitter:image" content={seoImage} />}
  </head>
  <body>
    <slot />
    {
      import.meta.env.PROD && (
        <script
          defer
          src="https://static.cloudflareinsights.com/beacon.min.js"
          data-cf-beacon={JSON.stringify({
            token: "982392cc0c7040f8a416accf8ecb2008",
          })}
        />
      )
    }
    <style lang="sass" is:global>
      body
        margin: 0
        width: 100%
        min-height: 100vh
        display: flex
        align-items: center
        justify-content: center
      *
        -webkit-box-sizing: border-box
        box-sizing: border-box
      a
        color: #fff
        text-decoration: #f00 wavy underline
        transition: text-decoration-color 128ms ease-in-out
        &:hover
          text-decoration-color: #fff
    </style>
    <style>
      body {
        background: #000;
      }
    </style>
  </body>
</html>
